//package com.project.service;
//
//import java.util.List;
//import java.util.Optional;
//
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.stereotype.Service;
//import org.springframework.web.bind.annotation.RequestBody;
//
//import com.project.entity.Admin;
//import com.project.entity.ServiceTable;
//import com.project.exception.ServiceException;
//import com.project.repository.AdminRepository;
//import com.project.repository.ServiceRepository;
//
//@Service
//public class Services {
//	
//	@Autowired
//	private ServiceRepository serviceRepository;
//	
//	@Autowired
//    private AdminRepository adminRepository; 
//	
//	//incomplete fetching logic
////	public List<ServiceTable> getAllServices() {
////        return serviceRepository.findAll();
////    }
//	
//	//adding services
//	public ServiceTable addService(@RequestBody ServiceTable serviceTable) {
//		try {
////			System.out.println(serviceTable.getAdmin());
////			Admin admin = serviceTable.getAdmin();
////            if (admin.getServiceTable() != null) {
////                admin.getServiceTable().add(serviceTable);
////            } else {
////                throw new ServiceException("Admin is required for adding a service");
////            }
////
////            // Save the service and the updated admin
////            serviceRepository.save(serviceTable);
////			return serviceTable;
//			 Admin admin = serviceTable.getAdmin();
//	            
//	            if (admin != null) {
//	                // Check if the Admin exists in the database
//	                Optional<Admin> existingAdmin = adminRepository.findById(admin.getId());
//	                if (existingAdmin.isPresent()) {
//	                    admin = existingAdmin.get();
//	                    admin.getServiceTable().add(serviceTable);
//	                    serviceTable.setAdmin(admin);
//	                    serviceRepository.save(serviceTable);
//	                    return serviceTable;
//		}catch(ServiceException e) {
//			throw new ServiceException("Error while adding services");
//		}
//	}
//	
//	
//}



package com.project.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.project.entity.Admin;
import com.project.entity.ServiceTable;
import com.project.exception.ServiceException;
import com.project.repository.AdminRepository;
import com.project.repository.ServiceRepository;

@Service
public class Services {

    @Autowired
    private ServiceRepository serviceRepository;

    @Autowired
    private AdminRepository adminRepository;

    public ServiceTable addService(ServiceTable serviceTable) {
        try {
            Admin admin = serviceTable.getAdmin();

            if (admin != null) {
                // Check if the Admin exists in the database
                if (admin.getId() != 0) {
                    Optional<Admin> existingAdmin = adminRepository.findById(admin.getId());
                    if (existingAdmin.isPresent()) {
                        admin = existingAdmin.get();
                    } else {
                        throw new ServiceException("Admin not found in the database");
                    }
                }

                // Set bidirectional relationship
                admin.getServiceTable().add(serviceTable);
                serviceTable.setAdmin(admin);

                // Save the service and the updated admin
                serviceRepository.save(serviceTable);

                return serviceTable;
            } else {
                throw new ServiceException("Admin is required for adding a service");
            }
        } catch (ServiceException e) {
            throw new ServiceException("Error while adding services", e);
        }
    }
}

